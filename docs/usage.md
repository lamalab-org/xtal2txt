# Text representation with xtal2txt

The `TextRep` class in `xtal2txt.core` facilitates the transformation of crystal structures into different text representations.
Below is an example of its usage:

```python
from xtal2txt.core import TextRep
from pymatgen.core import Structure


# Load structure from a CIF file
from_file = "InCuS2_p1.cif"
structure = Structure.from_file(from_file, "cif")

Initialize TextRep Class
text_rep = TextRep.from_input(structure)
```

## `get_requested_text_reps` method

The `get_requested_text_reps` method retrieves the requested text representations of the crystal structure and returns them in a dictionary.

For example, to obtain the `cif_p1`, `slice`, `atoms_params`, `crystal_llm_rep`, and `zmatrix` representations, use the following code:

```python
text_rep = TextRep(structure)

# Define a list of requested representations
requested_reps = [
    "cif_p1",
    "slice",
    "atoms_params",
    "crystal_llm_rep",
    "zmatrix"
]

# Get the requested text representations
requested_text_reps = text_rep.get_requested_text_reps(requested_reps)
```

## Supported text representations

The `TextRep` class currently supports the following text representations:

- **CIF Symmetrized** (`cif_symmetrized`): Multi-line CIF representation with symmetrized structure and rounded float numbers.
- **CIF P1** (`cif_p1`): Multi-line CIF representation with the conventional unit cell and rounded float numbers.
- **Slice** (`slice`): SLICE representation of the crystal structure.
- **Composition** (`composition`): Chemical composition in hill format.
- **Crystal Language Modeling Representation** (`crystal_llm_rep`): Representation following the format specified in the cited work.
- **Robocrystallographer Representation** (`robocrys_rep`): Representation generated by Robocrystallographer.
- **Atoms** (`atoms`): List of atoms inside the unit cell.
- **Atoms with Parameters** (`atoms_params`): List of atoms with lattice parameters.
- **Z-Matrix** (`zmatrix`): Z-Matrix representation of the crystal structure.

For more details on each representation and how to obtain them, refer to the respective method documentation in the `TextRep` class.

# Transformations

The `TextRep` class supports various transformations that can be applied to the input structure.


```python
from xtal2txt.core import TextRep

# Define transformations
transformations = [
  ("translate_single_atom", {"seed": 42}),
  ("perturb_structure", {"seed": 42, "max_distance": 0.1}),
  ("translate_structure", {"seed": 42, "vector": [0.1, 0.1, 0.1], "frac_coords": True})
]

# Generate text representation
text_rep = TextRep.from_input(structure)
```

The following transformations are available for transforming structures:

#### Randomly Permute Structure

- Function: {func}`permute_structure <TransformationCallback.permute_structure>`
- Description: Randomly permutes the order of atoms in a structure.
- Parameters:
  \- `seed` (int): The seed value for randomization. Default is 42.

#### Randomly Translate Single Atom
- Function: {func}`translate_single_atom <TransformationCallback.translate_single_atom>`
- Description: Randomly translates one or more atoms in a structure.
- Parameters:
  \- `max_indices` (int): The maximum number of atoms to translate. Default is 1.
  \- `vector` (List\[float\]): The translation vector. Default is \[0.25, 0.25, 0.25\].
  \- `seed` (int): The seed for random number generation. Default is 42.

#### Randomly Perturb Structure

- Function: {func}`perturb_structure <TransformationCallback.perturb_structure>`
- Description: Randomly perturbs atoms in a structure.
- Parameters:
 \- `max_distance` (float): The maximum perturbation distance. Default is 0.1.
 \- `seed` (int): The seed for random number generation. Default is 42.

#### Randomly Translate Structure

- Function: {func}`translate_structure <TransformationCallback.translate_structure>`
- Description: Randomly translates the atoms in a structure.
- Parameters:
 \- `vector` (List\[float\]): The translation vector. Default is \[0.1, 0.1, 0.1\].
 \- `seed` (int): The seed for random number generation. Default is 42.

 :::{note}
 This transformation supports additional keyword arguments for fine-tuning the translation.
 xtal2txt leverage methods from pymatgen and support all the keyword arguments in `Structure.translate_sites` method.
 :::

All transformations utilize a common seed value for reproducibility and accept additional parameters for customization.

For more details on each transformation and its parameters, refer to the respective function documentation.

# Tokenizers

## Using xtal2Txt tokenizers

By default, the tokenizer is initialized with `\[CLS\]` and `\[SEP\]` tokens.
For example

```python
from xtal2txt.tokenizer import SliceTokenizer

tokenizer = SliceTokenizer(
                model_max_length=512,
                truncation=True,
                padding="max_length",
                max_length=512
            )
print(tokenizer.cls_token) # returns [CLS]
```

You can access the `\[CLS\]` token using the `cls_token` attribute of the tokenizer. During decoding, you can utilize the `skip_special_tokens` parameter to skip these special tokens.

Decoding with skipping special tokens:

```python
tokenizer.decode(token_ids, skip_special_tokens=True)
```

## Initializing tokenizers with custom special tokens

In scenarios where the `\[CLS\]` token is not required, you can initialize the tokenizer with an empty special_tokens dictionary.

Initialization without `\[CLS\]` and `\[SEP\]` Tokens:

```python
tokenizer = SliceTokenizer(
                model_max_length=512,
                special_tokens={},
                truncation=True,
                padding="max_length",
                max_length=512
            )
```

All `Xtal2txtTokenizer` instances inherit from {ref}`PreTrainedTokenizer <regression_transformer>` and accept arguments compatible with the HuggingFace tokenizer.

## Tokenizers with special Number tokenization

The `special_num_token` argument (by default `False`) can be set to true to tokenize numbers in a special way as designed and implemented by {ref}`RegressionTransformer <regression_transformer>`.

```python
tokenizer = SliceTokenizer(
                special_num_token=True,
                model_max_length=512,
                special_tokens={},
                truncation=True,
                padding="max_length",
                max_length=512
            )
```